<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bootdo.xypjtx.dao.XypjtxDao">
    <select id="listMenu" resultType="com.bootdo.xypjtx.domain.MenuDO">
        select distinct
        m.menu_id , parent_id, name, url,
        perms,`type`,icon,order_num,gmt_create, gmt_modified
        from xypjtx_menu m
        WHERE
        m.type in(0,1)
        order by
        m.order_num
    </select>
    <select id="count" resultType="int">
        select count(*) from xypjtx_menu
        <where>
            <if test="cid != null and cid != ''"> and cid = #{cid} </if>
            <if test="title != null and title != ''"> and title = #{title} </if>
            <if test="subtitle != null and subtitle != ''"> and subtitle = #{subtitle} </if>
            <if test="created != null and created != ''"> and created = #{created} </if>
            <if test="modified != null and modified != ''"> and modified = #{modified} </if>
            <if test="content != null and content != ''"> and content = #{content} </if>
            <if test="status != null and status != ''"> and status = #{status} </if>
            <if test="author != null and author != ''"> and author = #{author} </if>
            <if test="gtmCreate != null and gtmCreate != ''"> and gtm_create = #{gtmCreate} </if>
            <if test="gtmModified != null and gtmModified != ''"> and gtm_modified = #{gtmModified} </if>
            <if test="zhiding != null and zhiding != ''"> and zhiding = #{zhiding} </if>
            <if test="fujian != null and fujian != ''"> and fujian = #{fujian} </if>
        </where>
    </select>
    <select id="getAll" resultType="com.bootdo.xypjtx.domain.XyggDO">
        select `cid`,`title`,`subtitle`,`created`,`modified`,`content`,`status`,`author`,`gtm_create`,`gtm_modified`,`zhiding`,`fujian` from xypjtx_xygg
        <where>
            status = 1
            <if test="cid != null and cid != ''"> and cid = #{cid} </if>
            <if test="title != null and title != ''"> and title = #{title} </if>
            <!--<if test="title != null and title != ''"> and title LIKE '%${title}%' </if>-->
            <if test="subtitle != null and subtitle != ''"> and subtitle = #{subtitle} </if>
            <if test="created != null and created != ''"> and created = #{created} </if>
            <if test="modified != null and modified != ''"> and modified = #{modified} </if>
            <if test="content != null and content != ''"> and content = #{content} </if>
            <if test="fenlei != null and fenlei != ''"> and fenlei = #{fenlei} </if>
            <!--<if test="status != null and status != ''"> and status = #{status} </if>-->
            <if test="author != null and author != ''"> and author = #{author} </if>
            <if test="gtmCreate != null and gtmCreate != ''"> and gtm_create = #{gtmCreate} </if>
            <if test="gtmModified != null and gtmModified != ''"> and gtm_modified = #{gtmModified} </if>
            <if test="mokuai != null and mokuai != ''"> and mokuai = #{mokuai} </if>
            <if test="shouyetupian != null and shouyetupian != ''"> and shouyetupian = #{shouyetupian} </if>
            <if test="zhiding != null and zhiding != ''"> and zhiding = #{zhiding} </if>
            <if test="fujian != null and fujian != ''"> and fujian = #{fujian} </if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by CASE WHEN zhiding =1 THEN 0 ELSE 1 END , ${sort} ${order}
            </when>
            <otherwise>
                order by CASE WHEN zhiding =1 THEN 0 ELSE 1 END , gtm_create desc
            </otherwise>
        </choose>
    </select>
    <select id="getMenuPerms" parameterType="java.lang.Long" resultType="java.lang.String">
        SELECT
        sm.perms
        FROM sys_user su
        INNER JOIN sys_user_role sur ON su.user_id = sur.user_id
        INNER JOIN sys_role sr ON sr.role_id = sur.role_id
        INNER JOIN sys_role_menu srm ON srm.role_id = sr.role_id
        INNER JOIN sys_menu sm ON sm.menu_id = srm.menu_id
        <where> su.user_id = #{userId}</where>
    </select>
    <select id="get" resultType="com.bootdo.xypjtx.domain.XyggDO">
        select `cid`,`title`,`subtitle`,`created`,`modified`,`content`,`status`,`author`,`gtm_create`,`gtm_modified`,`zhiding`,`fujian` from xypjtx_xygg where cid = #{value}
    </select>
    <select id="getDeptId" resultType="java.lang.Long">
        SELECT dept_id FROM sys_user LIMIT 0,1
    </select>
    <insert id="userSave" parameterType="com.bootdo.system.domain.UserDO">
        insert into sys_user
		(
			`username`,
			`name`,
			`password`,
			`dept_id`,
			`email`,
			`mobile`,
			`status`,
			`user_id_create`,
			`gmt_create`,
			`gmt_modified`,
			`sex`,
			`birth`,
			`pic_id`,
			`live_address`,
			`hobby`,
			`province`,
			`city`,
			`district`
		)
		values
		(
			#{username},
			#{name},
			#{password},
			#{deptId},
			#{email},
			#{mobile},
			#{status},
			#{userIdCreate},
			#{gmtCreate},
			#{gmtModified},
			#{sex},
			#{birth},
			#{picId},
			#{liveAddress},
			#{hobby},
			#{province},
			#{city},
			#{district}
		)
    </insert>
    <insert id="xzxkSave" parameterType="com.bootdo.xypjtx.domain.XzxkDO" useGeneratedKeys="true" keyProperty="xid">
        insert into xypjtx_xzxk
        (
        `ztmc`,
        `tyshxydm`,
        `gsdjzh`,
        `fddbrxm`,
        `xmmc`,
        `xzxkjdswh`,
        `splb`,
        `xknr`,
        `xksxq`,
        `xkjzq`,
        `xkjg`,
        `dqzt`,
        `dfbm`,
        `xxtgbm`,
        `sjbssj`,
        `xycns`,
        `dz`,
        `shouxcs`,
        `shixcs`,
        `xzcfcs`,
        `sh`,
        `tjz`,
        `beiyong1`,
        `beiyong2`
        )
        values
        (
        #{ztmc},
        #{tyshxydm},
        #{gsdjzh},
        #{fddbrxm},
        #{xmmc},
        #{xzxkjdswh},
        #{splb},
        #{xknr},
        #{xksxq},
        #{xkjzq},
        #{xkjg},
        #{dqzt},
        #{dfbm},
        #{xxtgbm},
        #{sjbssj},
        #{xycns},
        #{dz},
        #{shouxcs},
        #{shixcs},
        #{xzcfcs},
        #{sh},
        #{tjz},
        #{beiyong1},
        #{beiyong2}
        )
    </insert>
    <select id="getXycx" resultType="com.bootdo.xypjtx.domain.XzxkDO">
        select `xId`,`ztmc`,`tyshxydm`,`gsdjzh`,`fddbrxm`,`xmmc`,`xzxkjdswh`,`splb`,`xknr`,`xksxq`,`xkjzq`,`xkjg`,`dqzt`,`dfbm`,`xxtgbm`,`sjbssj`,`xycns`,`dz`,`shouxcs`,`shixcs`,`xzcfcs`,`sh`,`tjz`,`beiyong1`,`beiyong2` from xypjtx_xzxk
        <where>
            xId IN (SELECT MAX(xId) FROM xypjtx_xzxk
            <where>
                sh = 1
                <if test="xid != null and xid != ''"> and xId = #{xid} </if>
                <if test="ztmc != null and ztmc != ''"> and ztmc = #{ztmc} </if>
                <if test="tyshxydm != null and tyshxydm != ''"> and tyshxydm = #{tyshxydm} </if>
                <if test="gsdjzh != null and gsdjzh != ''"> and gsdjzh = #{gsdjzh} </if>
                <if test="fddbrxm != null and fddbrxm != ''"> and fddbrxm = #{fddbrxm} </if>
                <if test="xmmc != null and xmmc != ''"> and xmmc = #{xmmc} </if>
                <if test="xzxkjdswh != null and xzxkjdswh != ''"> and xzxkjdswh = #{xzxkjdswh} </if>
                <if test="splb != null and splb != ''"> and splb = #{splb} </if>
                <if test="xknr != null and xknr != ''"> and xknr = #{xknr} </if>
                <if test="xksxq != null and xksxq != ''"> and xksxq = #{xksxq} </if>
                <if test="xkjzq != null and xkjzq != ''"> and xkjzq = #{xkjzq} </if>
                <if test="xkjg != null and xkjg != ''"> and xkjg = #{xkjg} </if>
                <if test="dqzt != null and dqzt != ''"> and dqzt = #{dqzt} </if>
                <if test="dfbm != null and dfbm != ''"> and dfbm = #{dfbm} </if>
                <if test="xxtgbm != null and xxtgbm != ''"> and xxtgbm = #{xxtgbm} </if>
                <if test="sjbssj != null and sjbssj != ''"> and sjbssj = #{sjbssj} </if>
                <if test="xycns != null and xycns != ''"> and xycns = #{xycns} </if>
                <if test="dz != null and dz != ''"> and dz = #{dz} </if>
                <if test="shouxcs != null and shouxcs != ''"> and shouxcs = #{shouxcs} </if>
                <if test="shixcs != null and shixcs != ''"> and shixcs = #{shixcs} </if>
                <if test="xzcfcs != null and xzcfcs != ''"> and xzcfcs = #{xzcfcs} </if>
                <!--<if test="sh != null and sh != ''"> and sh = #{sh} </if>-->
                <if test="tjz != null and tjz != ''"> and tjz = #{tjz} </if>
                <if test="beiyong1 != null and beiyong1 != ''"> and beiyong1 = #{beiyong1} </if>
                <if test="beiyong2 != null and beiyong2 != ''"> and beiyong2 = #{beiyong2} </if>
            </where>
            GROUP BY `tyshxydm`)
        </where>
        <choose>
            <!--<when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>-->
            <otherwise>
                order by xId desc
            </otherwise>
        </choose>
        <!--<if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>-->
    </select>
    <select id="getXycxCount" resultType="int">
        select count(*) from xypjtx_xzxk
        <where>
            sh = 1
            <if test="xid != null and xid != ''"> and xId = #{xid} </if>
            <if test="ztmc != null and ztmc != ''"> and ztmc = #{ztmc} </if>
            <if test="tyshxydm != null and tyshxydm != ''"> and tyshxydm = #{tyshxydm} </if>
            <if test="gsdjzh != null and gsdjzh != ''"> and gsdjzh = #{gsdjzh} </if>
            <if test="fddbrxm != null and fddbrxm != ''"> and fddbrxm = #{fddbrxm} </if>
            <if test="xmmc != null and xmmc != ''"> and xmmc = #{xmmc} </if>
            <if test="xzxkjdswh != null and xzxkjdswh != ''"> and xzxkjdswh = #{xzxkjdswh} </if>
            <if test="splb != null and splb != ''"> and splb = #{splb} </if>
            <if test="xknr != null and xknr != ''"> and xknr = #{xknr} </if>
            <if test="xksxq != null and xksxq != ''"> and xksxq = #{xksxq} </if>
            <if test="xkjzq != null and xkjzq != ''"> and xkjzq = #{xkjzq} </if>
            <if test="xkjg != null and xkjg != ''"> and xkjg = #{xkjg} </if>
            <if test="dqzt != null and dqzt != ''"> and dqzt = #{dqzt} </if>
            <if test="dfbm != null and dfbm != ''"> and dfbm = #{dfbm} </if>
            <if test="xxtgbm != null and xxtgbm != ''"> and xxtgbm = #{xxtgbm} </if>
            <if test="sjbssj != null and sjbssj != ''"> and sjbssj = #{sjbssj} </if>
            <if test="xycns != null and xycns != ''"> and xycns = #{xycns} </if>
            <if test="dz != null and dz != ''"> and dz = #{dz} </if>
            <if test="shouxcs != null and shouxcs != ''"> and shouxcs = #{shouxcs} </if>
            <if test="shixcs != null and shixcs != ''"> and shixcs = #{shixcs} </if>
            <if test="xzcfcs != null and xzcfcs != ''"> and xzcfcs = #{xzcfcs} </if>
            <!--<if test="sh != null and sh != ''"> and sh = #{sh} </if>-->
            <if test="tjz != null and tjz != ''"> and tjz = #{tjz} </if>
            <if test="beiyong1 != null and beiyong1 != ''"> and beiyong1 = #{beiyong1} </if>
            <if test="beiyong2 != null and beiyong2 != ''"> and beiyong2 = #{beiyong2} </if>
        </where>
    </select>

    <select id="getXzxkList" resultType="com.bootdo.xypjtx.domain.XzxkDO">
        select `xId`,`ztmc`,`tyshxydm`,`gsdjzh`,`fddbrxm`,`xmmc`,`xzxkjdswh`,`splb`,`xknr`,`xksxq`,`xkjzq`,`xkjg`,`dqzt`,`dfbm`,`xxtgbm`,`sjbssj`,`xycns`,`dz`,`shouxcs`,`shixcs`,`xzcfcs`,`sh`,`tjz`,`beiyong1`,`beiyong2` from xypjtx_xzxk
        <where>
            sh = 1
             and tyshxydm = #{tyshxydm}
        </where>
        <choose>
            <!--<when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>-->
            <otherwise>
                order by xId desc
            </otherwise>
        </choose>
    </select>

    <select id="getXycxBySearch" resultType="com.bootdo.xypjtx.domain.XzxkDO">
        select `xId`,`ztmc`,`tyshxydm`,`gsdjzh`,`fddbrxm`,`xmmc`,`xzxkjdswh`,`splb`,`xknr`,`xksxq`,`xkjzq`,`xkjg`,`dqzt`,`dfbm`,`xxtgbm`,`sjbssj`,`xycns`,`dz`,`shouxcs`,`shixcs`,`xzcfcs`,`sh`,`tjz`,`beiyong1`,`beiyong2` from xypjtx_xzxk
        <where>
            xId IN (SELECT MAX(xId) FROM xypjtx_xzxk
            <where>
                sh = 1
                <if test="xid != null and xid != ''"> and xId = #{xid} </if>
                <if test="ztmc != null and ztmc != ''"> and ztmc LIKE '%${ztmc}%' </if>
                <if test="tyshxydm != null and tyshxydm != ''"> OR tyshxydm LIKE '%${tyshxydm}%' </if>
                <if test="gsdjzh != null and gsdjzh != ''"> and gsdjzh = #{gsdjzh} </if>
                <if test="fddbrxm != null and fddbrxm != ''"> and fddbrxm = #{fddbrxm} </if>
                <if test="xmmc != null and xmmc != ''"> and xmmc = #{xmmc} </if>
                <if test="xzxkjdswh != null and xzxkjdswh != ''"> and xzxkjdswh = #{xzxkjdswh} </if>
                <if test="splb != null and splb != ''"> and splb = #{splb} </if>
                <if test="xknr != null and xknr != ''"> and xknr = #{xknr} </if>
                <if test="xksxq != null and xksxq != ''"> and xksxq = #{xksxq} </if>
                <if test="xkjzq != null and xkjzq != ''"> and xkjzq = #{xkjzq} </if>
                <if test="xkjg != null and xkjg != ''"> and xkjg = #{xkjg} </if>
                <if test="dqzt != null and dqzt != ''"> and dqzt = #{dqzt} </if>
                <if test="dfbm != null and dfbm != ''"> and dfbm = #{dfbm} </if>
                <if test="xxtgbm != null and xxtgbm != ''"> and xxtgbm = #{xxtgbm} </if>
                <if test="sjbssj != null and sjbssj != ''"> and sjbssj = #{sjbssj} </if>
                <if test="xycns != null and xycns != ''"> and xycns = #{xycns} </if>
                <if test="dz != null and dz != ''"> and dz = #{dz} </if>
                <if test="shouxcs != null and shouxcs != ''"> and shouxcs = #{shouxcs} </if>
                <if test="shixcs != null and shixcs != ''"> and shixcs = #{shixcs} </if>
                <if test="xzcfcs != null and xzcfcs != ''"> and xzcfcs = #{xzcfcs} </if>
                <if test="tjz != null and tjz != ''"> and tjz = #{tjz} </if>
                <if test="beiyong1 != null and beiyong1 != ''"> and beiyong1 = #{beiyong1} </if>
                <if test="beiyong2 != null and beiyong2 != ''"> and beiyong2 = #{beiyong2} </if>
            </where>
            GROUP BY `tyshxydm`)
        </where>
        <choose>
            <otherwise>
                order by xId desc
            </otherwise>
        </choose>
    </select>
    <select id="xycxCountBySearch" resultType="int">
        select count(*) from xypjtx_xzxk
        <where>
            sh = 1
            <if test="xid != null and xid != ''"> and xId = #{xid} </if>
            <if test="ztmc != null and ztmc != ''"> and ztmc LIKE '%${ztmc}%' </if>
            <if test="tyshxydm != null and tyshxydm != ''"> and tyshxydm LIKE '%${tyshxydm}%' </if>
            <if test="gsdjzh != null and gsdjzh != ''"> and gsdjzh = #{gsdjzh} </if>
            <if test="fddbrxm != null and fddbrxm != ''"> and fddbrxm = #{fddbrxm} </if>
            <if test="xmmc != null and xmmc != ''"> and xmmc = #{xmmc} </if>
            <if test="xzxkjdswh != null and xzxkjdswh != ''"> and xzxkjdswh = #{xzxkjdswh} </if>
            <if test="splb != null and splb != ''"> and splb = #{splb} </if>
            <if test="xknr != null and xknr != ''"> and xknr = #{xknr} </if>
            <if test="xksxq != null and xksxq != ''"> and xksxq = #{xksxq} </if>
            <if test="xkjzq != null and xkjzq != ''"> and xkjzq = #{xkjzq} </if>
            <if test="xkjg != null and xkjg != ''"> and xkjg = #{xkjg} </if>
            <if test="dqzt != null and dqzt != ''"> and dqzt = #{dqzt} </if>
            <if test="dfbm != null and dfbm != ''"> and dfbm = #{dfbm} </if>
            <if test="xxtgbm != null and xxtgbm != ''"> and xxtgbm = #{xxtgbm} </if>
            <if test="sjbssj != null and sjbssj != ''"> and sjbssj = #{sjbssj} </if>
            <if test="xycns != null and xycns != ''"> and xycns = #{xycns} </if>
            <if test="dz != null and dz != ''"> and dz = #{dz} </if>
            <if test="shouxcs != null and shouxcs != ''"> and shouxcs = #{shouxcs} </if>
            <if test="shixcs != null and shixcs != ''"> and shixcs = #{shixcs} </if>
            <if test="xzcfcs != null and xzcfcs != ''"> and xzcfcs = #{xzcfcs} </if>
            <!--<if test="sh != null and sh != ''"> and sh = #{sh} </if>-->
            <if test="tjz != null and tjz != ''"> and tjz = #{tjz} </if>
            <if test="beiyong1 != null and beiyong1 != ''"> and beiyong1 = #{beiyong1} </if>
            <if test="beiyong2 != null and beiyong2 != ''"> and beiyong2 = #{beiyong2} </if>
        </where>
    </select>
</mapper>